# Hack ALU 仕様書

# 1\. 概要

Hack ALUは、**Hackコンピュータ**のCPU（中央演算処理装置）の**演算の中核**となるチップです。  
ALUの設計原則は一般的で教育的ですが、Hack ALUの設計はHackプラットフォーム固有のものです。  
ALUは、算術演算および論理演算を実行するように設計されており、**整数演算のみ**を行います（浮動小数点演算は行いません）。  
Hack ALUは、6つの制御ビットによって指定される**18種類の演算論理関数**を実行するように設計されています。

# 2\. データおよび演算の特性 

| 項目 | 詳細 |
| :---- | :---- |
| **データ型** | 符号付き16ビット整数（**2の補数表現**） |
| **演算の種類** | 18種類の演算論理関数 |
| **演算対象** | 16ビットの入力 *x* および *y* |

# 3\. 入出力ピン仕様 (Input/Output Pin Specification)

Hack ALUのインターフェースは、以下の入力と出力で構成されます。

| ピン名 | ビット幅 | 種類 | 役割 |
| :---- | :---- | :---- | :---- |
| *x* | 16ビット | 入力 | 演算対象の第一入力 |
| *y* | 16ビット | 入力 | 演算対象の第二入力 |
| *zx* | 1ビット | 制御入力 | *x* をゼロにするか（ゼロに設定する場合は1） |
| *nx* | 1ビット | 制御入力 | *x* を否定するか（否定する場合は1） |
| *zy* | 1ビット | 制御入力 | *y* をゼロにするか（ゼロに設定する場合は1） |
| *ny* | 1ビット | 制御入力 | *y* を否定するか（否定する場合は1） |
| *f* | 1ビット | 制御入力 | 演算の機能（加算またはAND）を選択 |
| *no* | 1ビット | 制御入力 | 出力を否定するか（否定する場合は1） |
| *out* | 16ビット | 出力 | 演算結果 |
| *zr* | 1ビット | 出力 | *out* がゼロであるかを示すフラグ（ゼロなら1） |
| *ng* | 1ビット | 出力 | *out* が負であるかを示すフラグ（負なら1） |

# 4\. 制御ビットによる演算指定

Hack ALUが実行する演算は、6つの制御ビット（*zx*,*nx*,*zy*,*ny*,*f*,*no*）の値によって決定されます。これらの制御ビットは、一連の順序付けられたマイクロアクションを引き起こします。

**演算処理の順序:**  
制御ビットによって、以下のマイクロアクションが順に実行されます。すべての設定、否定、加算、論理積は16ビット操作です。

1\. **入力ゼロ化と否定（***x* **および** *y* **の前処理）:**  
    ◦ *zx*: *zx*\=1 の場合、*x* を 0 に設定する。  
    ◦ *nx*: *nx*\=1 の場合、*x* を否定する。  
    ◦ *zy*: *zy*\=1 の場合、*y* を 0 に設定する。  
    ◦ *ny*: *ny*\=1 の場合、*y* を否定する。

2\. **演算の実行:**  
    ◦ *f*: *f*\=1 の場合、前処理された *x* と *y* の値に対して**加算**（\+）を計算する。  
    ◦ *f*\=0 の場合、前処理された *x* と *y* の値に対して**ビットごとのAND**（&）を計算する。

3\. **出力の否定:**  
    ◦ *no*: *no*\=1 の場合、結果として得られた値を否定する。  
この結果が *out* として出力されます。

**出力フラグの計算:**  
演算結果 *out* に基づき、以下の2つのフラグが計算されます。  
• *zr*: *out* がゼロ（16ビットすべて0）の場合に 1。  
• *ng*: *out* が負である場合（16ビットの最上位ビットが1）に 1。

# 5\. Hack ALU 文書化された演算関数一覧

以下の表は、Hack ALUに入力される16ビットのデータ *x* および *y* に対し、6つの制御ビット (*zx*,*nx*,*zy*,*ny*,*f*,*no*) の組み合わせによって実行される演算（*out*）を示します。

| 制御ビット (*zx*,*nx*,*zy*,*ny*,*f*,*no*) | 実行される関数 (out) |
| :---- | :---- |
| **101000** | **0** |
| **111111** | **1** |
| **111010** | **\-1** |
| 001100 | *x* |
| 001101 | *x*\+1 |
| 001110 | *x*−1 |
| 000111 | \!*x* (NOT x) |
| 001111 | −*x* |
| 110000 | *y* |
| 110111 | *y*\+1 |
| 110010 | *y*−1 |
| 110001 | \!*y* (NOT y) |
| 110010 | −*y* |
| **000010** | *x*\+*y* |
| 010011 | *x*−*y* |
| 000111 | *y*−*x* |
| **000000** | *x*&*y* (AND) |
| 010101 | *x*∣*y* (OR) |
| 000101 | \!(*x*&*y*) (NAND) |
| 011001 | \!(*x*∣*y*) (NOR) |

